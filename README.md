# 模拟论坛的问答平台项目（持续更新）


## 技术栈
工具：IDEA，Centos7服务器，Navicat。

- SpringBoot
- BootStrap
- MySQL
- MyBatis
- Redis
- Solr

## 目录
- [项目的基本框架及配置](#项目的基本框架及配置)
- [AOP与IOC](#AOP和IOC)
- [数据库创建与Mybatis集成](#数据库创建与Mybatis集成)
- [注册登录登出模块](#注册登录登出模块)
- [问题发布及敏感词过滤](#问题发布及敏感词过滤)
- [评论中心和站内信模块](#评论中心和站内信模块)
- [点赞和点踩模块](#点赞和点踩模块)
- [异步消息通知与邮件发送](#异步消息通知与邮件发送)
- [问题和用户的关注和粉丝模块](#问题和用户的关注和粉丝模块)


## 项目的基本框架及配置
使用IDEA创建SpringBoot项目，生成基于maven的项目。

使用pom.xml添加web，aop，devtools等库的依赖

创建本地git仓库，与github进行连接。可以直接使用IDEA的git工具进行操作，感觉方便又强大

## AOP和IOC

IOC 解决对象实例化以及依赖传递问题，解耦。
    
AOP 解决纵向切面问题，主要实现日志和权限控制功能。
    
Aspect 实现切面，并且使用 logger 来记录日志，用该切面的切面方法来监听 Controller。

## 数据库创建与Mybatis集成

使用Mysql创建用户数据表和提出的问题数据表

SpringBoot使用Mybatis进行数据库表的操作和映射

编写首页前端，将用户数据和绑定的问题数据输出到前端展示

## 注册登录登出模块

### 注册

1. 用户名和密码合法性验证
2. 密码salt加密，密码强度检测(md5库)

### 登录

1. 服务器密码校验/三方校验回调，token登记 

   1.1 服务器端token关联userid 
   1.2 客户端存储token(app存储本地，浏览器存储cookie)

2. 服务端/客户端token有效期设置（记住登陆）

3. 拦截器设置，根据cookie中的ticket获取访问的用户信息

### 登出

设置cookie中ticket状态为1，view渲染登出处理

> 为什么不使用session共享数据，而使用数据表来共享token/ticket

这样做可以使访问多个服务器时都可以共享数据，获取用户数据的信息。

### 未登录跳转

借助拦截器我们可以对请求进行分析，如果当前访问的用户未登录，就进行重定向到登录注册页面
同时携带当前页面请求信息，可以使登录注册完成之后直接跳转到要访问的页面


## 问题发布及敏感词过滤

增加问题发布和查看页面，在问题发布时增加敏感词的过滤替代

防止 xss 注入直接使用 HTMLutils 的方法即可实现

根据敏感问题文本构建**字典树模型**处理敏感词，替换敏感词。将该过滤作为一个服务，让需要需要过滤敏感词调用该服务。

## 评论中心和站内信模块

评论中心和站内信模块都是比较简单就能实现的模块，主要就是要注意数据库表单的设计

消息的逻辑是，两个用户之间发送一条消息，有一个唯一的会话 id，这个会话里可以有多条这两个用户的交互信息。通过一个用户 id 获取该用户的会话列表，再根据会话 id 再获取具体的会话内的多条消息。

在页面中设计评论和站内信分页

## 点赞和点踩模块
在评论中设置对评论的点赞和点踩操作，这个模块主要是基于Redis实现的

我们需要根据业务封装好对于Jedis操作的Service

根据需求确定 key 字段，格式是——like：实体类型：实体id 和 dislike：实体类型：实体 id。这样可以将喜欢一条新闻的人存在一个集合，不喜欢的存在另一个集合。通过统计数量可以获得点赞和点踩数。

一般点赞点踩操作是先修改 Redis 的值并获取返回值，然后再异步修改 MySQL 数据库的 likecount 数值。这样既可以保证点赞操作快速完成，也可保证数据一致性。

## 异步消息通知与邮件发送

有一些不需要实时进行执行的操作和服务，或者并发量高的服务，可以将这些服务改造成异步消息进行处理

具体的操作是利用Redis来实现异步消息机制，将事件分装成为一个Java对象EventModel，事件需要记录事件实体的各种信息：
一个异步工具类（事件生产者 + 事件消费者 + EventHandler 接口），让以后各种事件的实现类来实现这个接口。

事件生产者一般作为一个服务，由 Controller 中的业务逻辑调用并产生一个事件，将事件序列化存入 Redis 队列中，事件消费者则通过一个线程循环获取队列里的事件，
并且寻找对应的 handler 进行处理。

整个异步事件的框架开发完成，后面新加入的登录，点赞等事件都可以这么实现


## 问题和用户的关注和粉丝模块

利用Redis实现关注和粉丝列表


利用Redis的SortedSet属性添加对问题和用户的关注，用户点击问题或者其他用户的关注。

这时候其实是两个操作，一个是向关注列表中插入一条关注信息，一个向粉丝列表中插入一条粉丝信息。
由于关注成功和添加粉丝成功时同一个事务里的两个操作，可以使用 Redis 的事务 multi 来包装事务并进行提交。

关注成功或者被关注还可以通过事件机制来生成发送邮件的事件，由异步的队列处理器来完成事件响应，是根据 Redis 来实现。

对于粉丝列表，除了显示粉丝的基本信息之外，还要显示当前用户是否关注了这个粉丝，以便前端显示。

对于关注列表来说，如果被关注对象是用户的话，除了显示用户的基本信息之外，还要显示当前用户是被这个用户关注，以便前端显示。
